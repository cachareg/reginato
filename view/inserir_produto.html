<!DOCTYPE html>
<html lang="en">
<head>
	
	<!-- start: Meta -->
	<meta charset="utf-8">
	<title>SimpliQ - Flat & Responsive Bootstrap Admin Template</title>
	<meta name="description" content="SimpliQ - Flat & Responsive Bootstrap Admin Template.">
	<meta name="author" content="Łukasz Holeczek">
	<meta name="keyword" content="SimpliQ, Dashboard, Bootstrap, Admin, Template, Theme, Responsive, Fluid, Retina">
	<!-- end: Meta -->
	
	<!-- start: Mobile Specific -->
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<!-- end: Mobile Specific -->
	
	<!-- start: CSS -->
	<link href="css/bootstrap.min.css" rel="stylesheet">
	<link href="css/bootstrap-responsive.min.css" rel="stylesheet">
	<link href="css/style.min.css" rel="stylesheet">
	<link href="css/style-responsive.min.css" rel="stylesheet">
	<link href="css/retina.css" rel="stylesheet">
	<!-- end: CSS -->
	

	<!-- The HTML5 shim, for IE6-8 support of HTML5 elements -->
	<!--[if lt IE 9]>
	  	<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
		<link id="ie-style" href="css/ie.css" rel="stylesheet">
	<![endif]-->
	
	<!--[if IE 9]>
		<link id="ie9style" href="css/ie9.css" rel="stylesheet">
	<![endif]-->
	
	<!-- start: Favicon and Touch Icons -->
	<link rel="apple-touch-icon-precomposed" sizes="144x144" href="ico/apple-touch-icon-144-precomposed.png">
	<link rel="apple-touch-icon-precomposed" sizes="114x114" href="ico/apple-touch-icon-114-precomposed.png">
	<link rel="apple-touch-icon-precomposed" sizes="72x72" href="ico/apple-touch-icon-72-precomposed.png">
	<link rel="apple-touch-icon-precomposed" href="ico/apple-touch-icon-57-precomposed.png">
	<link rel="shortcut icon" href="ico/favicon.png">
	<!-- end: Favicon and Touch Icons -->	
	

	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="css/jquery-ui.css">
	<script src="https://code.jquery.com/jquery-1.12.4.js"></script>
	<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
	

</head>

<body >

	<div id="inserir_produto" >

			<div class="row-fluid" >		
				<div class="box span12">
					<div class="box-header" data-original-title >
							<h2><i class="icon-user"></i><span class="break"></span>Novo</h2>
					</div>

					<div class="box-content" >

						<form class="form-horizontal" >

							<fieldset id="campos">


								<div class="control-group">
									<label class="control-label" for="focusedInput">Nome </label>
									<div class="controls">
								  		<input class="input-xlarge focused" id="nome" type="text" value="">
									</div>
								</div>		
								<div class="control-group">
									<label class="control-label" for="focusedInput">Adicionar Fotos </label>
									<div class="controls" >
										<!--<input type="file" onchange="savePics()" id="arquivos" name="files" multiple="" /> -->

											<input type="file" id="arquivos" onchange="loadname(this,'previewimg')" name="files" webkitdirectory multiple />
											<ul id="listing"></ul>
											<table class="fotos" width="600" style="display:inline">

											</table>
											<div id="trashFotos"  style="display:none"><a class="btn btn-danger" id="exclude" height="40" width="40"><i class="icon-trash " height="40" width="40"></i> </a> </div>
									</div>
									
								</div>	
							 	<div class="control-group">
								<label class="control-label" for="selectError">Fábrica</label>

								<div class="controls">
								  <select id="fabrica_select" data-rel="chosen">
								  </select>	
								
							  	</div>
							  </div>
							  <div class="control-group">
							  <div class="controls">
								  <label class="checkbox inline">
									<input type="checkbox" id="inlineCheckbox2" class="lanc" value="option5"> Lançamento</input>
								  </label>
								  <label class="checkbox inline">
									<input type="checkbox" id="inlineCheckbox2" class="ativo" checked selected="true" value="option5"> Ativo</input>
								  </label>
								</div>	
								</div>
								<div class="control-group">
									<label class="control-label" for="selectError">Categoria</label>

									<div class="controls">
									  <select id="categoria" data-rel="chosen">
										
									  </select>	
									  <button class="btn"  onclick="addRowCat()" type="button">OK</button>
									</div>
								</div>
								
								<div  class="row-fluid" id="tabela" style="  float:inherit; marging-top:20px; padding-top:20px; display: none">
									<div class="box span6">
										<div class="box-header">
											<h2><i class="icon-align-justify"></i><span class="break"></span>Categorias</h2>
										</div>
										<div class="box-content" >
											<table class="table" id="tabela_categorias">
											  <thead>
												  <tr>
													  <th>Categoria</th>
													  <th>Excluir</th>
													                                    
												  </tr>
											  </thead>   
										
											</table>  
										</div>     
									</div>
							  	</div>
							  	<div class="control-group">
									<label class="control-label" for="selectError2">Características</label>
									<div class="controls">
								  		<select id="selectError2" data-rel="chosen">
											
											
								  		</select>
								   		<button class="btn"  onclick="addRowCar()" type="button">OK</button>
									</div>
								</div>
									<div  class="row-fluid" id="tabela2" style="  float:inherit; marging-top:20px; padding-top:20px; display: none">
										<div class="box span6">
											<div class="box-header">
												<h2><i class="icon-align-justify"></i><span class="break"></span>Características</h2>
											</div>
										<div class="box-content" >
											<table class="table" id="tabela_caracteristicas">
												  <thead>
													  <tr>
														  <th>Característica</th>
														  <th>Excluir</th>
														  <th>Valores</th>                                      
													  </tr>
												  </thead>   
												  <tbody>
													                         
												  </tbody>
											</table>  
										</div>     
									</div>

								</div>	
								<div id="actions" style="clear: left; float: left; position: relative; left: 80%; ">
									<button id="salvar" type="button"  class="btn btn-primary">Salvar</button>
									<button type="reset" class="btn">Limpar</button>
								</div>
							  </div>
							
								
							</fieldset>
						</form>
					</div>
				</div>
			</div><!--/span-->
		</div>
	</div>
	
	<style>
		.selecionada{
			border-color: red;
			border-style:dashed;
			border-width: 3px;
		}
	</style>

	<div id="dialog" style="display:none" title="Selecione" >
		<img width="50"  class="img" title="prata" height="50" src="http://greenhousemoveis.com.br/wp-content/uploads/2016/06/Alumínino-Branco-Fosco-150x150.jpg"/>
		<img width="50" class="img" height="50" src="http://greenhousemoveis.com.br/wp-content/uploads/2016/06/Alumínio-Amarelo-150x150.jpg"/>
		<img width="50" class="img" height="50" src="http://greenhousemoveis.com.br/wp-content/uploads/2016/06/Alumínio-Azul-Metalico-150x150.jpg"/>
	</div>

	<script>
		var index=0;
		var list = new Array();
		var ordem= []; 
		var j=0;
		var sem=1;
		function loadname(img){ 

			//console.log(this);
			var isIE = (navigator.appName=="Microsoft Internet Explorer");  
			//var path = img.value;  
			//var ext = path.substring(path.lastIndexOf('.') + 1).toLowerCase(); 
			//console.log(path);
			//console.log(ext); 
			if($(".fotos tr").length==0){
				$('.fotos').append('<tr> </tr>');
			}
			
			files= img.files;
			for(var i=0; i<img.files.length; i++){
				
				if(img.files[i]){
					//var ext = img.files[i].value.substring(path.lastIndexOf('.') + 1).toLowerCase();
					var ext= (img.files[i].webkitRelativePath.substring(img.files[i].webkitRelativePath.lastIndexOf('.') + 1).toLowerCase()); 
					if(ext == "jpg" || ext == "png"){
						sem=0;
						var o = new Object();
						var reader = new FileReader();  
						
						j++;
						//index++;
			            reader.onload = function(teste) { return function (e) {  
			            	//console.log(e);
				            	$('.fotos tr').append('<td> <img src="'+e.target.result+'" name="'+teste.name+'"class="img" height="40" width="40" alt="" /> </td> ');
				               	ordem.push(teste);
				              	
				            };
			        	}(img.files[i]);
			         	reader.readAsDataURL(img.files[i]);
				        
				        
				        //list.push(img.files[i]);
				    }
			        //console.log(list);			
			    }
			}
			//$("#arquivos").val('');
					
			$('#exclude').show();
			$('#trashFotos').css("display", "inline");
			$('#trashFotos').css("vertical-align", "top");
			
		}  

		$("#exclude").click(function(event){
				var qtd=$(".fotos").find("tr:first td").length;
				$(".fotos tr").each(function () {
					var count =0; 
				    $('td', this).each(function () {
				       if($(this).children().hasClass("selecionada")){
				       	
				       	for(i in ordem){
				       		//console.log()
				       		if(ordem[i].name==$(this).children().attr("name")){
				       			ordem.splice(i, 1);
				       		}
				       	}
				       	console.log(ordem);
				       	$(this).remove();
				       }
				       //console.log(list);
				       if(count==qtd){
				       		$("#exclude").hide();
				       		$(".fotos tr").remove();
				       }
				     })

				})
		});
		
		$("#salvar").click(function(event){
			//alert($('#tabela_categorias tr').length);
			if($("nome").text=="" || $("pasta").text=="" || $('#tabela_categorias tr').length==1 || $('#tabela_caracteristicas tr').length==1){
				alert("aqui");
			}else{
				var formData = new FormData();
		        for (var key in ordem) {
		          	formData.append(key, ordem[key]);
		        }
		       	var $select= $("#nome");
		        formData.append("nome", $("#nome").val());
		        console.log("nome = "+$("#nome").val());
		        var $select= $("#fabrica_select");
		        formData.append("fabrica",$($select.find(":selected")[0]).text());
		        console.log("fabrica = "+$($select.find(":selected")[0]).text());
		        console.log($(".lanc")[0].checked);
		        formData.append("lancamento",$(".lanc")[0].checked);
		        console.log($(".ativo")[0].checked);
		        formData.append("ativo",$(".ativo")[0].checked);
		        
		        ///var size_categorias =$("#tabela_categorias > tr").length;
		        var $tableCatSize= $($("#tabela_categorias").find("thead")[0]).find("tr").length;
		        var $tableCarSize= $($("#tabela_caracteristicas").find("thead")[0]).find("tr").length;
		        var categorias= [];
		        var caracteristicas= [];
		        for(var i=1;i<$tableCatSize;i++){
		        	categorias[i]= ($($($("#tabela_categorias").find("thead")[0]).find("tr").find("td")[0]).html());
		        }
		        formData.append("categorias", categorias);
		        for(var i=1;i<$tableCarSize;i++){
		        	caracteristicas[i]= ($($($("#tabela_caracteristicas").find("thead")[0]).find("tr").find("td")[0]).html());
		        }

		        formData.append("action", "inserirProduto");
				$.ajax({
					url: "../controllers/cadastros.php",
		            type: 'POST',
		            data:  formData,
		            success: function (data) {
	                	console.log(data);
	            	},
	            	error: function (data) {
	                	console.log(data);
	            	},
		            cache: false,
		            contentType: false,
	            	processData: false
		    	});	
		    }
		});
		//$('body').on('click', 'a.myclass', function() {
		$("body").on("click", ".img" , function(event){
			if($(this).hasClass("selecionada")){
				$(this).removeClass("selecionada");
			}else{
				$(this).addClass("selecionada");
			}
		});

		function addRowCat(){
     		if($("#tabela").css('display')=='none'){
     			if($("#selectError").val()!= ""){
     				console.log($("#selectError").val());
     				$("#tabela").show();
     			}
     		}
     		if($("#selectError").val()!= ""){		
     			//$('#tabela_categorias > tbody').appendTo('<tr> <td>'+$("#selectError").val()+'</td> <td><a class="btn btn-danger" ><i class="icon-trash "></i> </a></td>');
     			$('#tabela_categorias tr:last').after('<tr> <td>'+$("#categoria").val()+'</td> <td><a class="btn btn-danger" ><i class="icon-trash "></i> </a></td>');
     		}
     	}

     	function addRowCar(){
     		if($("#tabela2").css('display')=='none'){
     			if($("#selectError2").val()!= ""){
     				console.log($("#selectError2").val());
     				$("#tabela2").show();
     			}
     		}
     		if($("#selectError2").val()!= ""){		
     			$('#tabela_caracteristicas tr:last').after('<tr> <td>'+$("#selectError2").val()+'</td> <td><a class="btn btn-danger" ><i class="icon-trash "></i> </a> </td><td><a class="btn btn-info" href="#" onclick="openCar()"><i class="icon-edit "></i></a></td></tr>');
     		}
     	}

		$( "#dialog" ).dialog({
			autoOpen: false,
			width: 400,
			buttons: [
				{
					text: "Salvar",
					click: function() {
						$( this ).dialog( "close" );
						console.log($(this).children());
					}
				},
				{
					text: "Cancelar",
					click: function() {
						$( this ).dialog( "close" );
					}
				}
			]
		});

		// Link to open the dialog
		function openCar(){

			$( "#dialog" ).dialog( "open" );
		};


	</script>
	<script src="js/jquery.chosen.min.js"></script>	


<!-- start: JavaScript-->
	<script src="js/jquery-migrate-1.2.1.min.js"></script>	
		<script src="js/jquery-ui-1.10.3.custom.min.js"></script>	
		<script src="js/jquery.ui.touch-punch.js"></script>	
		<script src="js/modernizr.js"></script>	
		<script src="js/bootstrap.min.js"></script>	
		<script src="js/jquery.cookie.js"></script>	
		<script src='js/fullcalendar.min.js'></script>	
		<script src='js/jquery.dataTables.min.js'></script>
		<script src="js/excanvas.js"></script>
	<script src="js/jquery.flot.js"></script>
	<script src="js/jquery.flot.pie.js"></script>
	<script src="js/jquery.flot.stack.js"></script>
	<script src="js/jquery.flot.resize.min.js"></script>
	<script src="js/jquery.flot.time.js"></script>
		
		
		<script src="js/jquery.uniform.min.js"></script>		
		<script src="js/jquery.cleditor.min.js"></script>	
		<script src="js/jquery.noty.js"></script>	
		<script src="js/jquery.elfinder.min.js"></script>	
		<script src="js/jquery.raty.min.js"></script>	
		<script src="js/jquery.iphone.toggle.js"></script>	
		<script src="js/jquery.uploadify-3.1.min.js"></script>	
		<script src="js/jquery.gritter.min.js"></script>	
		<script src="js/jquery.imagesloaded.js"></script>	
		<script src="js/jquery.masonry.min.js"></script>	
		<script src="js/jquery.knob.modified.js"></script>	
		<script src="js/jquery.sparkline.min.js"></script>	
		<script src="js/counter.min.js"></script>	
		<script src="js/raphael.2.1.0.min.js"></script>
	<script src="js/justgage.1.0.1.min.js"></script>	
		<script src="js/jquery.autosize.min.js"></script>	
		<script src="js/retina.js"></script>
		<script src="js/jquery.placeholder.min.js"></script>
		<script src="js/wizard.min.js"></script>
		<script src="js/core.min.js"></script>	
		<script src="js/charts.min.js"></script>	
		<script src="js/custom.min.js"></script>
	<!-- end: JavaScript-->
	
</body>

	<script>
	
	var caracteristicas= [];

	$( document ).ready(function() {

		$.ajax({
				url: "../controllers/cadastros.php",
		        context: document.body,
		        data: "action=getAllCaracteristicasCategoriasFabricas",
		        dataType:'json',
		        type: "GET",
		        	success: function(data){
		        		console.log(data);
		        		//$("#selectError2").empty();
		        		for (var i = 0, len = data["caracteristicas"].length; i < len; i++) {
		        			console.log(data["caracteristicas"][i].nome);
		        			if(data["caracteristicas"][i].nome!=""){
		        				$("#selectError2").append('<option>'+data["caracteristicas"][i].nome+'</option>');
		        			}
		        		}	
		        		for (var i = 0, len = data["fabricas"].length; i < len; i++) {
		        			console.log(data["fabricas"][i].nome);
		        			if(data["fabricas"][i].nome!=undefined){
		        				$("#fabrica_select").append('<option value="'+data["fabricas"][i].id_fabrica+'">'+data["fabricas"][i].nome+'</option>');
		        			}
		        		}
		        		for (var i = 0, len = data["caracteristicas"].length; i < len; i++) {
		        			//console.log(data["caracteristicas"][i].nome);
		        			if(data["caracteristicas"][i].nome!=undefined){
		        				$("#selectError2").append('<option value="'+data["caracteristicas"][i].id_caracteristica+'">'+data["caracteristicas"][i].nome+'</option>');
		        			}
		        		}
		        		for (var i = 0, len = data["categorias"].length; i < len; i++) {
		        			//console.log(data["caracteristicas"][i].nome);
		        			if(data["categorias"][i].nome!=undefined){
		        				$("#categoria").append('<option value="'+data["categorias"][i].id_categoria+'">'+data["categorias"][i].nome+'</option>');
		        			}
		        		}
		        		//$("#selectError2").append('<option>'+"teste"+'</option>');
		        		
		        		$("#selectError2").trigger("liszt:updated");
		        		$("#selectError2").chosen();
		        		$("#fabrica_select").trigger("liszt:updated");
		        		$("#fabrica_select").chosen();
		        		$("#categoria").trigger("liszt:updated");
		        		$("#categoria").chosen();
		        		$('.row-fluid').height($('.row-fluid').height+ 100);
			        },
			        error: function(data){
					 	console.log(data);
			        }

		});
		$( "#dialog" ).dialog();
	 
	});
	
	 </script>
</html>